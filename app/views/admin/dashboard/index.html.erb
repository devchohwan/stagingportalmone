<div class="flex h-screen bg-gray-50">
  <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
  <div class="w-72 bg-white border-r border-gray-200">
    <div class="p-6 border-b border-gray-100">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-violet-600 rounded-xl flex items-center justify-center">
          <span class="text-white text-lg">âš¡</span>
        </div>
        <div>
          <h1 class="text-xl font-bold text-gray-900">Spawning Pool</h1>
          <p class="text-xs text-gray-500">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </div>
      </div>
    </div>
    
    <nav class="p-4">
      <p class="text-xs text-gray-400 uppercase tracking-wider mb-3 px-3">ë©”ì¸ ë©”ë‰´</p>
      <ul class="space-y-1">
        <li>
          <a href="javascript:void(0)" data-tab="dashboard" class="tab-link active flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 transition-colors">
            <span class="text-lg">ğŸ“Š</span>
            <div>
              <span class="font-medium">í•œëˆˆì— ë³´ê¸°</span>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" data-tab="users" class="tab-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 transition-colors">
            <span class="text-lg">ğŸ‘¥</span>
            <div>
              <span class="font-medium">íšŒì› ê´€ë¦¬</span>
            </div>
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" data-tab="reservations" class="tab-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 transition-colors">
            <span class="text-lg">ğŸ“…</span>
            <div>
              <span class="font-medium">ì˜ˆì•½ ê´€ë¦¬</span>
            </div>
          </a>
        </li>
      </ul>
    </nav>
    
    <div class="absolute bottom-0 w-72 p-6 border-t border-gray-100">
      <div class="flex items-center space-x-3 mb-4">
      </div>
      <a href="/services" class="flex items-center justify-center space-x-2 text-gray-600 hover:text-gray-900 bg-gray-50 hover:bg-gray-100 py-2 px-4 rounded-lg transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        <span class="text-sm">ì„œë¹„ìŠ¤ ë©”ì¸ìœ¼ë¡œ</span>
      </a>
    </div>
  </div>
  
  <!-- ì˜¤ë¥¸ìª½ ì½˜í…ì¸  ì˜ì—­ -->
  <div class="flex-1 overflow-hidden">
    <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
    <div id="dashboard-tab" class="tab-content h-full p-8 overflow-auto">
      <div class="max-w-7xl mx-auto">
        <div class="mb-8">
          <h2 class="text-3xl font-bold text-gray-900">Dashboard Overview</h2>
          <p class="text-gray-500 mt-1">ì‹œìŠ¤í…œ ì „ì²´ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
        </div>
        
        <!-- íšŒì› ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="mb-10">
          <div class="flex items-center mb-6">
            <h3 class="text-xl font-bold text-gray-800">íšŒì› ê´€ë¦¬</h3>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div class="bg-white rounded-2xl p-6 border border-gray-100" onclick="document.querySelector('[data-tab=\"users\"]').click(); loadUsersTab('waiting');">
              <div class="flex items-center justify-between mb-4">
                <span class="text-2xl">â³</span>
              </div>
              <p class="text-sm text-gray-500 mb-1">ìŠ¹ì¸ ëŒ€ê¸°</p>
              <p class="text-3xl font-bold text-gray-900"><%= @total_pending_users %></p>
            </div>
            
            <div class="bg-white rounded-2xl p-6 border border-gray-100" onclick="document.querySelector('[data-tab=\"users\"]').click(); loadUsersTab('approved');">
              <div class="flex items-center justify-between mb-4">
                <span class="text-2xl">ğŸ‘¥</span>
              </div>
              <p class="text-sm text-gray-500 mb-1">ì „ì²´ ì‚¬ìš©ì</p>
              <p class="text-3xl font-bold text-gray-900"><%= @total_users %></p>
            </div>
          </div>
        </div>
        
        <!-- ì˜ˆì•½ í†µê³„ ì„¹ì…˜ -->
        <div class="mb-10">
          <div class="flex items-center mb-6">
            <h3 class="text-xl font-bold text-gray-800">ì—°ìŠµì‹¤ ì˜ˆì•½ í˜„í™©</h3>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div class="bg-white rounded-2xl p-6 border border-gray-100" onclick="document.querySelector('[data-tab=\"reservations\"]').click();">
              <div class="flex items-center justify-between mb-4">
                <span class="text-2xl">ğŸ¹</span>
              </div>
              <p class="text-sm text-gray-500 mb-1">ì˜¤ëŠ˜ ì—°ìŠµì‹¤ ì˜ˆì•½</p>
              <p class="text-3xl font-bold text-gray-900"><%= @practice_todays_reservations || 0 %></p>
            </div>
            
            <div class="bg-white rounded-2xl p-6 border border-gray-100" onclick="document.querySelector('[data-tab=\"reservations\"]').click();">
              <div class="flex items-center justify-between mb-4">
                <span class="text-2xl">ğŸµ</span>
              </div>
              <p class="text-sm text-gray-500 mb-1">ì§„í–‰ì¤‘ì¸ ì—°ìŠµì‹¤ ì˜ˆì•½</p>
              <p class="text-3xl font-bold text-gray-900"><%= @practice_active_reservations || 0 %></p>
            </div>
          </div>
        </div>
        
        <div class="mb-10">
          <div class="flex items-center mb-6">
            <h3 class="text-xl font-bold text-gray-800">ë³´ì¶©ìˆ˜ì—… ì˜ˆì•½ í˜„í™©</h3>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div class="bg-white rounded-2xl p-6 border border-gray-100">
              <div class="flex items-center justify-between mb-4">
                <span class="text-2xl">ğŸ“š</span>
              </div>
              <p class="text-sm text-gray-500 mb-1">ì˜¤ëŠ˜ ë³´ì¶©ìˆ˜ì—… ì˜ˆì•½</p>
              <p class="text-3xl font-bold text-gray-900"><%= @makeup_todays_reservations || 0 %></p>
            </div>
            
            <div class="bg-white rounded-2xl p-6 border border-gray-100">
              <div class="flex items-center justify-between mb-4">
                <span class="text-2xl">âœï¸</span>
              </div>
              <p class="text-sm text-gray-500 mb-1">ì§„í–‰ì¤‘ì¸ ë³´ì¶©ìˆ˜ì—… ì˜ˆì•½</p>
              <p class="text-3xl font-bold text-gray-900"><%= @makeup_active_reservations || 0 %></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- í†µí•© íšŒì› ê´€ë¦¬ íƒ­ -->
    <div id="users-tab" class="tab-content hidden h-full p-8 overflow-auto">
      <div id="users-content-area" class="h-full">
        <!-- íšŒì› ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë¨ -->
      </div>
    </div>
    
    <!-- ì˜ˆì•½ ê´€ë¦¬ íƒ­ -->
    <div id="reservations-tab" class="tab-content hidden h-full p-8 overflow-auto">
      <div id="reservations-content-area" class="h-full">
        <!-- ì˜ˆì•½ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë¨ -->
      </div>
    </div>
  </div>
</div>

<style>
  :root {
    --primary: oklch(0.5393 0.2713 286.7462);
    --primary-foreground: oklch(1.0000 0 0);
  }
  
  .tab-link.active {
    background-color: rgba(139, 92, 246, 0.1);
    color: rgb(139, 92, 246);
    font-weight: 600;
  }
  
  /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: #f9fafb;
    border-radius: 10px;
  }
  
  ::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 10px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
  }
  
  /* ë¶€ë“œëŸ¬ìš´ í°íŠ¸ ë Œë”ë§ */
  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
</style>

<script>
  // Initialize global functions immediately
  if (typeof window.adminFunctionsInitialized === 'undefined') {
    window.adminFunctionsInitialized = true;
    
    window.changeTab = function(tab) {
      if (!tab) tab = 'approved';
      const contentArea = document.getElementById('users-content-area');
      if (!contentArea) return;
      
      // í˜„ì¬ íƒ­ ì €ì¥
      window.currentUsersTab = tab;
      
      contentArea.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-violet-600"></div></div>';
      
      fetch(`/admin/users/content?tab=${tab}`)
        .then(response => response.text())
        .then(html => {
          contentArea.innerHTML = html;
        })
        .catch(error => {
          console.error('Error loading users:', error);
          contentArea.innerHTML = '<div class="text-center py-8 text-red-600">íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
        });
    };
    
    // í˜„ì¬ íƒ­ ê°€ì ¸ì˜¤ê¸° í—¬í¼ í•¨ìˆ˜
    window.getCurrentTab = function() {
      // í˜„ì¬ í™œì„±í™”ëœ íƒ­ ë²„íŠ¼ì—ì„œ íƒ­ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const activeTabBtn = document.querySelector('.tab-btn.active');
      if (activeTabBtn) {
        const onclickAttr = activeTabBtn.getAttribute('onclick');
        const match = onclickAttr.match(/changeTab\('([^']+)'\)/);
        if (match) return match[1];
      }
      // ì €ì¥ëœ íƒ­ ì •ë³´ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
      return window.currentUsersTab || 'approved';
    };

    window.holdUser = function(userId, system) {
      if(confirm('ì´ ì‚¬ìš©ìë¥¼ ë³´ë¥˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/hold` : `/admin/practice/users/${userId}/hold`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.changeTab(getCurrentTab());
        });
      }
    };

    window.approveUser = function(userId, system) {
      if(confirm('ì´ ì‚¬ìš©ìë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/approve` : `/admin/practice/users/${userId}/approve`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.changeTab(getCurrentTab());
        });
      }
    };

    window.rejectUser = function(userId, system) {
      if(confirm('ì´ ì‚¬ìš©ìë¥¼ ê±°ë¶€/ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reject` : `/admin/practice/users/${userId}/reject`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.changeTab(getCurrentTab());
        });
      }
    };

    window.deleteUser = function(userId, system) {
      if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reject` : `/admin/practice/users/${userId}/reject`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.changeTab(getCurrentTab());
        });
      }
    };

    window.updateTeacher = function(userId, teacher, system) {
      const url = system === 'makeup' ? `/admin/makeup/users/${userId}/update_teacher` : `/admin/practice/users/${userId}/update_teacher`;
      fetch(url, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ teacher: teacher })
      });
    };
    
    // ì˜ˆì•½ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    window.updateReservationStatus = function(reservationId, status, service) {
      fetch(`/admin/reservations/${reservationId}/update_status.json`, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ status: status, service: service })
      }).then(response => {
        if (response.ok) {
          window.loadReservationsTab(service);
        } else {
          alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }).catch(error => {
        console.error('Error:', error);
        alert('ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    };

    window.deleteReservation = function(reservationId, service) {
      if (confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        fetch(`/admin/reservations/${reservationId}.json`, {
          method: 'DELETE',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ service: service })
        }).then(response => {
          if (response.ok) {
            window.loadReservationsTab(service);
          } else {
            alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        }).catch(error => {
          console.error('Error:', error);
          alert('ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
      }
    };

    window.resetPassword = function(userId, username, system) {
      const newPassword = prompt(`${username}ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìµœì†Œ 6ì):`);
      if (newPassword && newPassword.length >= 6) {
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reset_password` : `/admin/practice/users/${userId}/reset_password`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ password: newPassword })
        }).then(() => {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
      } else if (newPassword) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
      }
    };
    
    // ê²€ìƒ‰ ê¸°ëŠ¥ (ê¸€ë¡œë²Œ í•¨ìˆ˜)
    window.searchUsers = function() {
      const searchInput = document.getElementById('user-search');
      const systemFilter = document.getElementById('system-filter');
      if (!searchInput) {
        console.log('Search input not found');
        return;
      }
      
      const searchTerm = searchInput.value.toLowerCase();
      const systemValue = systemFilter ? systemFilter.value : '';
      const rows = document.querySelectorAll('.user-row');
      
      console.log(`Searching for: ${searchTerm}, System: ${systemValue}, Found ${rows.length} rows`);
      
      rows.forEach(row => {
        const name = (row.getAttribute('data-name') || '').toLowerCase();
        const username = (row.getAttribute('data-username') || '').toLowerCase();
        const system = row.getAttribute('data-system') || '';
        
        let matchSearch = searchTerm === '' || name.includes(searchTerm) || username.includes(searchTerm);
        let matchSystem = systemValue === '' || system === systemValue;
        
        if (matchSearch && matchSystem) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    };
    
    // ì‹œìŠ¤í…œ í•„í„°ë§ ê¸°ëŠ¥
    window.filterBySystem = function() {
      searchUsers(); // ê²€ìƒ‰ í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ ë‘ í•„í„° ëª¨ë‘ ì ìš©
    };
    
    // í˜ë„í‹° ì´ˆê¸°í™” í•¨ìˆ˜ (ê¸€ë¡œë²Œ í•¨ìˆ˜)
    window.resetPenalty = function(userId, system) {
      if(confirm('ì´ ì‚¬ìš©ìì˜ í˜ë„í‹°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reset_penalty` : `/admin/practice/users/${userId}/reset_penalty`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(response => {
          if (response.ok) {
            alert('í˜ë„í‹°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.changeTab('penalty');
          } else {
            alert('í˜ë„í‹° ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        });
      }
    };

    // ì˜ˆì•½ ê´€ë¦¬ ê²€ìƒ‰ ë° í•„í„°ë§ í•¨ìˆ˜ë“¤ ì¶”ê°€
    window.searchReservations = function() {
      const searchInput = document.getElementById('reservation-search');
      if (!searchInput) return;
      
      const searchTerm = searchInput.value.toLowerCase();
      const rows = document.querySelectorAll('.reservation-row');
      
      rows.forEach(row => {
        const name = (row.getAttribute('data-name') || '').toLowerCase();
        const username = (row.getAttribute('data-username') || '').toLowerCase();
        
        if (searchTerm === '' || name.includes(searchTerm) || username.includes(searchTerm)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    };

    window.filterReservations = function() {
      const statusFilter = document.getElementById('reservation-status')?.value || '';
      const dateFilter = document.getElementById('reservation-date')?.value || '';
      const searchTerm = (document.getElementById('reservation-search')?.value || '').toLowerCase();
      const rows = document.querySelectorAll('.reservation-row');
      
      rows.forEach(row => {
        let visible = true;
        
        if (searchTerm) {
          const name = (row.getAttribute('data-name') || '').toLowerCase();
          const username = (row.getAttribute('data-username') || '').toLowerCase();
          if (!name.includes(searchTerm) && !username.includes(searchTerm)) {
            visible = false;
          }
        }
        
        if (statusFilter && visible) {
          const status = row.getAttribute('data-status');
          if (status !== statusFilter) {
            visible = false;
          }
        }
        
        if (dateFilter && visible) {
          const date = row.getAttribute('data-date');
          if (date !== dateFilter) {
            visible = false;
          }
        }
        
        row.style.display = visible ? '' : 'none';
      });
    };

    window.resetReservationFilters = function() {
      const searchInput = document.getElementById('reservation-search');
      const statusSelect = document.getElementById('reservation-status');
      const dateInput = document.getElementById('reservation-date');
      
      if (searchInput) searchInput.value = '';
      if (statusSelect) statusSelect.value = '';
      if (dateInput) dateInput.value = '';
      
      const rows = document.querySelectorAll('.reservation-row');
      rows.forEach(row => {
        row.style.display = '';
      });
    };

    window.applyReservationFilters = function() {
      window.filterReservations();
    };

    // ëŒ€ì‹œë³´ë“œì—ì„œ ì˜ˆì•½ ê´€ë¦¬ë¡œ ì§ì ‘ ì´ë™
    window.showReservationsTab = function(service) {
      // ì˜ˆì•½ ê´€ë¦¬ íƒ­ í™œì„±í™”
      document.querySelector('[data-tab="reservations"]').click();
      
      // ì„œë¹„ìŠ¤ íƒ€ì…ì— ë”°ë¼ iframe ê²½ë¡œ ì„¤ì •
      const iframe = document.getElementById('reservations-iframe');
      if (service) {
        iframe.src = `/admin/reservations?service=${service}`;
      }
    };
    
    // ì˜ˆì•½ ê´€ë¦¬ íƒ­ ë¡œë“œ
    window.loadReservationsTab = function(service) {
      if (!service) service = 'practice';
      const contentArea = document.getElementById('reservations-content-area');
      if (!contentArea) return;
      
      // í˜„ì¬ ì„œë¹„ìŠ¤ íƒ€ì… ì €ì¥
      window.currentReservationService = service;
      
      contentArea.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-violet-600"></div></div>';
      
      fetch(`/admin/reservations/content?service=${service}`)
        .then(response => response.text())
        .then(html => {
          contentArea.innerHTML = html;
        })
        .catch(error => {
          console.error('Error loading reservations:', error);
          contentArea.innerHTML = '<div class="text-center py-8 text-red-600">ì˜ˆì•½ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
        });
    };
    
    // í†µí•© íšŒì› ê´€ë¦¬ íƒ­ ë¡œë“œ
    window.loadUsersTab = function(tab) {
      if (!tab) tab = getCurrentTab();  // í˜„ì¬ íƒ­ ìœ ì§€
      const contentArea = document.getElementById('users-content-area');
      if (!contentArea) return;
      
      // í˜„ì¬ íƒ­ ì €ì¥
      window.currentUsersTab = tab;
      
      contentArea.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-violet-600"></div></div>';
      
      fetch(`/admin/users/content?tab=${tab}`)
        .then(response => response.text())
        .then(html => {
          contentArea.innerHTML = html;
        })
        .catch(error => {
          console.error('Error loading users:', error);
          contentArea.innerHTML = '<div class="text-center py-8 text-red-600">íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
        });
    };
  }
  
  // Tab switching functionality - Initialize once
  function initializeTabSwitching() {
    // Check if already initialized
    if (window.tabSwitchingInitialized) return;
    window.tabSwitchingInitialized = true;
    
    // Use event delegation for tab clicking
    document.addEventListener('click', function(e) {
      const tabLink = e.target.closest('.tab-link');
      if (!tabLink) return;
      
      e.preventDefault();
      e.stopPropagation();
      
      const tabLinks = document.querySelectorAll('.tab-link');
      const tabContents = document.querySelectorAll('.tab-content');
      
      // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
      tabLinks.forEach(l => l.classList.remove('active'));
      tabContents.forEach(c => c.classList.add('hidden'));
      
      // í´ë¦­í•œ íƒ­ í™œì„±í™”
      tabLink.classList.add('active');
      const tabId = tabLink.getAttribute('data-tab') + '-tab';
      const tabContent = document.getElementById(tabId);
      if (tabContent) {
        tabContent.classList.remove('hidden');
      }
      
      // ë°ì´í„° ë¡œë“œ
      const tabName = tabLink.getAttribute('data-tab');
      if (tabName === 'reservations') {
        loadReservationsTab();
      } else if (tabName === 'users') {
        loadUsersTab();
      }
    });
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeTabSwitching);
  } else {
    initializeTabSwitching();
  }
  
  // Also initialize on Turbo navigation
  document.addEventListener('turbo:load', initializeTabSwitching);
  
  // ëŒ€ì‹œë³´ë“œì—ì„œ ì˜ˆì•½ ê´€ë¦¬ë¡œ ì§ì ‘ ì´ë™
  function showReservationsTab(service) {
    // ì˜ˆì•½ ê´€ë¦¬ íƒ­ í™œì„±í™”
    document.querySelector('[data-tab="reservations"]').click();
    
    // ì„œë¹„ìŠ¤ íƒ€ì…ì— ë”°ë¼ iframe ê²½ë¡œ ì„¤ì •
    const iframe = document.getElementById('reservations-iframe');
    if (service) {
      iframe.src = `/admin/reservations?service=${service}`;
    }
  }
  
  // ì˜ˆì•½ ê´€ë¦¬ íƒ­ ë¡œë“œ (duplicate function removed - using window.loadReservationsTab)
  
  // í†µí•© íšŒì› ê´€ë¦¬ íƒ­ ë¡œë“œ
  function loadUsersTab(tab) {
    if (!tab) tab = 'approved';
    const contentArea = document.getElementById('users-content-area');
    contentArea.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-violet-600"></div></div>';
    
    fetch(`/admin/users/content?tab=${tab}`)
      .then(response => response.text())
      .then(html => {
        contentArea.innerHTML = html;
      })
      .catch(error => {
        console.error('Error loading users:', error);
        contentArea.innerHTML = '<div class="text-center py-8 text-red-600">íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
      });
  }
  
  // Users management functions - moved from partial to make them globally available
  window.changeTab = function(tab) {
    loadUsersTab(tab);
  };

  window.approveUser = function(userId, system) {
    if(confirm('ì´ ì‚¬ìš©ìë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      const url = system === 'makeup' ? `/admin/makeup/users/${userId}/approve` : `/admin/practice/users/${userId}/approve`;
      fetch(url, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        }
      }).then(() => {
        loadUsersTab();
      });
    }
  };

  window.holdUser = function(userId, system) {
    if(confirm('ì´ ì‚¬ìš©ìë¥¼ ë³´ë¥˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      const url = system === 'makeup' ? `/admin/makeup/users/${userId}/hold` : `/admin/practice/users/${userId}/hold`;
      fetch(url, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        }
      }).then(() => {
        loadUsersTab();
      });
    }
  };

  window.rejectUser = function(userId, system) {
    if(confirm('ì´ ì‚¬ìš©ìë¥¼ ê±°ë¶€/ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
      const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reject` : `/admin/practice/users/${userId}/reject`;
      fetch(url, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        }
      }).then(() => {
        loadUsersTab();
      });
    }
  };

  window.deleteUser = function(userId, system) {
    if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reject` : `/admin/practice/users/${userId}/reject`;
      fetch(url, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        }
      }).then(() => {
        loadUsersTab();
      });
    }
  };

  window.updateTeacher = function(userId, teacher, system) {
    const url = system === 'makeup' ? `/admin/makeup/users/${userId}/update_teacher` : `/admin/practice/users/${userId}/update_teacher`;
    fetch(url, {
      method: 'PATCH',
      headers: {
        'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ teacher: teacher })
    });
  };

  window.updatePhone = function(userId, type, system) {
    const phoneInput = document.getElementById(`phone-${type}-${userId}`);
    const phone = phoneInput.value;
    
    const url = system === 'makeup' ? `/admin/makeup/users/${userId}/update_info` : `/admin/practice/users/${userId}/update_info`;
    fetch(url, {
      method: 'PATCH',
      headers: {
        'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ 
        phone: phone 
      })
    }).then(response => {
      if(response.ok) {
        alert('ì „í™”ë²ˆí˜¸ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else {
        alert('ì „í™”ë²ˆí˜¸ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    });
  };

  window.resetPassword = function(userId, username, system) {
    const newPassword = prompt(`${username}ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìµœì†Œ 6ì):`);
    if (newPassword && newPassword.length >= 6) {
      const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reset_password` : `/admin/practice/users/${userId}/reset_password`;
      fetch(url, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ password: newPassword })
      }).then(() => {
        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
      });
    } else if (newPassword) {
      alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
    }
  };
</script>