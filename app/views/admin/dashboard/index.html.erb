<style>
  /* íšŒì› ê´€ë¦¬ íƒ­ ìŠ¤íƒ€ì¼ */
  #users-tab .tab-btn {
    padding: 10px 16px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    background: transparent;
    color: #4a5568;
  }
  
  #users-tab .tab-btn:hover {
    background: #edf2f7;
    color: #2d3748;
  }
  
  #users-tab .tab-btn.active {
    background: #ffffff !important;
    color: #667eea !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
  }
  
  #users-tab .search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  #users-tab .search-button:hover {
    background: #5a67d8;
    border-color: #5a67d8;
  }
  
  #users-tab .clear-button:hover {
    background: #edf2f7;
    color: #2d3748;
  }
  
  .admin-container {
    min-height: 100vh;
    background: #ffffff;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    padding: 40px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .admin-header {
    text-align: center;
    margin-bottom: 40px;
  }
  
  .admin-title {
    font-size: 1.8rem;
    font-weight: bold;
    color: #2d3748;
    margin-bottom: 10px;
    line-height: 1.3;
  }
  
  .admin-subtitle {
    font-size: 1.1rem;
    color: #718096;
    margin-bottom: 0;
  }
  
  .content-wrapper {
    width: 100%;
    max-width: 1200px;
  }
  
  .admin-nav {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    padding: 20px;
    margin-bottom: 30px;
  }
  
  .nav-tabs {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .nav-tab {
    background: #f7fafc;
    color: #4a5568;
    padding: 12px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .nav-tab:hover {
    background: #edf2f7;
    color: #2d3748;
    transform: translateY(-1px);
  }
  
  .nav-tab.active {
    background: linear-gradient(135deg, #fa709a, #fee140);
    color: white;
    border-color: #fa709a;
  }
  
  .nav-tab.active::after {
    content: 'ğŸ‘‘';
    margin-left: 5px;
  }
  
  .dashboard-section {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    padding: 30px;
    margin-bottom: 30px;
  }
  
  .section-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2d3748;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: #ffffff;
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  }
  
  .stat-card.clickable {
    cursor: pointer;
  }
  
  .stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    margin-bottom: 15px;
    color: white;
  }
  
  .stat-users { background: linear-gradient(135deg, #667eea, #764ba2); }
  .stat-practice { background: linear-gradient(135deg, #f093fb, #f5576c); }
  .stat-makeup { background: linear-gradient(135deg, #4facfe, #00f2fe); }
  .stat-admin { background: linear-gradient(135deg, #fa709a, #fee140); }
  
  .stat-label {
    font-size: 0.9rem;
    color: #718096;
    margin-bottom: 5px;
  }
  
  .stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #2d3748;
  }
  
  .summary-card {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
    border: 2px solid rgba(102, 126, 234, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
  }
  
  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    text-align: center;
  }
  
  .summary-item {
    padding: 10px;
  }
  
  .summary-label {
    font-size: 0.9rem;
    color: #4a5568;
    margin-bottom: 5px;
  }
  
  .summary-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2d3748;
  }
  
  .back-link {
    color: #718096;
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.3s ease;
    text-align: center;
    display: block;
    margin-top: 30px;
    padding: 12px 20px;
    background: #f7fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
  }
  
  .back-link:hover {
    color: #2d3748;
    background: #edf2f7;
    text-decoration: none;
  }
  
  .tab-content {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    padding: 30px;
    min-height: 400px;
  }
  
  .hidden {
    display: none !important;
  }
  
  /* 320px ëª¨ë°”ì¼ ìµœì í™” */
  @media (max-width: 320px) {
    .admin-container {
      padding: 16px 12px;
      min-height: 100vh;
    }
    
    .admin-header {
      margin-bottom: 24px;
    }
    
    .admin-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 6px;
    }
    
    .admin-subtitle {
      font-size: 0.85rem;
      color: #718096;
    }
    
    .admin-nav {
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 10px;
    }
    
    .nav-tabs {
      flex-direction: column;
      gap: 8px;
    }
    
    .nav-tab {
      font-size: 0.9rem;
      padding: 10px 14px;
      border-radius: 6px;
      width: 100%;
      justify-content: center;
    }
    
    .dashboard-section {
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 10px;
    }
    
    .section-title {
      font-size: 1.1rem;
      margin-bottom: 16px;
      gap: 6px;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      padding: 16px;
      border-radius: 10px;
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      font-size: 20px;
      margin-bottom: 12px;
      border-radius: 8px;
    }
    
    .stat-label {
      font-size: 0.8rem;
      margin-bottom: 4px;
    }
    
    .stat-value {
      font-size: 1.4rem;
    }
    
    .summary-card {
      padding: 16px;
      margin-top: 16px;
      border-radius: 10px;
    }
    
    .summary-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .summary-item {
      padding: 8px;
    }
    
    .summary-label {
      font-size: 0.75rem;
      margin-bottom: 4px;
    }
    
    .summary-value {
      font-size: 1.1rem;
    }
    
    .tab-content {
      padding: 16px;
      min-height: 300px;
      border-radius: 10px;
    }
    
    .back-link {
      font-size: 0.85rem;
      padding: 10px 16px;
      margin-top: 20px;
      border-radius: 6px;
    }
  }
  
  @media (max-width: 480px) {
    .admin-title {
      font-size: 1.4rem;
      white-space: nowrap;
    }
    
    .admin-subtitle {
      font-size: 0.9rem;
    }
    
    .admin-container {
      padding: 20px 15px;
    }
    
    .content-wrapper {
      max-width: 100%;
    }
    
    .nav-tabs {
      flex-direction: column;
    }
    
    .nav-tab {
      font-size: 14px;
      padding: 10px 16px;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .stat-card {
      padding: 20px;
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      font-size: 20px;
    }
    
    .stat-value {
      font-size: 1.5rem;
    }
    
    .section-title {
      font-size: 1.2rem;
    }
    
    .dashboard-section {
      padding: 20px;
    }
    
    .summary-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    
    .summary-value {
      font-size: 1.2rem;
    }
    
    .tab-content {
      padding: 20px;
    }
  }
</style>

<div class="admin-container">
  <div class="admin-header">
    <h1 class="admin-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
    <p class="admin-subtitle">ëª¨ë„¤ë®¤ì§ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
  </div>

  <div class="content-wrapper">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
    <div class="admin-nav">
      <div class="nav-tabs">
        <a href="javascript:void(0)" class="nav-tab active" data-tab="dashboard">
          ğŸ“Š í•œëˆˆì— ë³´ê¸°
        </a>
        <a href="javascript:void(0)" class="nav-tab" data-tab="users">
          ğŸ‘¥ íšŒì› ê´€ë¦¬
        </a>
        <a href="javascript:void(0)" class="nav-tab" data-tab="reservations">
          ğŸ“… ì˜ˆì•½ ê´€ë¦¬
        </a>
      </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
    <div id="dashboard-tab" class="tab-content">
      <div class="dashboard-section">
        <h2 class="section-title">
          ğŸ‘¥ íšŒì› í˜„í™©
        </h2>
        <div class="stats-grid">
          <div class="stat-card clickable" onclick="switchToTab('users', 'waiting')">
            <div class="stat-icon stat-users">â³</div>
            <div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
            <div class="stat-value"><%= @total_pending_users || 0 %></div>
          </div>
          <div class="stat-card clickable" onclick="switchToTab('users', 'approved')">
            <div class="stat-icon stat-users">âœ…</div>
            <div class="stat-label">ì „ì²´ ì‚¬ìš©ì</div>
            <div class="stat-value"><%= @total_users || 0 %></div>
          </div>
        </div>
      </div>

      <div class="dashboard-section">
        <h2 class="section-title">
          ğŸ¹ ì—°ìŠµì‹¤ ì˜ˆì•½ í˜„í™©
        </h2>
        <div class="stats-grid">
          <div class="stat-card clickable" onclick="switchToTab('reservations', 'practice')">
            <div class="stat-icon stat-practice">ğŸ“…</div>
            <div class="stat-label">ì˜¤ëŠ˜ ì—°ìŠµì‹¤ ì˜ˆì•½</div>
            <div class="stat-value"><%= @practice_todays_reservations || 0 %></div>
          </div>
          <div class="stat-card clickable" onclick="switchToTab('reservations', 'practice')">
            <div class="stat-icon stat-practice">ğŸµ</div>
            <div class="stat-label">ì§„í–‰ì¤‘ì¸ ì—°ìŠµì‹¤ ì˜ˆì•½</div>
            <div class="stat-value"><%= @practice_active_reservations || 0 %></div>
          </div>
        </div>
      </div>

      <div class="dashboard-section">
        <h2 class="section-title">
          ğŸ“š ë³´ì¶©ìˆ˜ì—… ì˜ˆì•½ í˜„í™©
        </h2>
        <div class="stats-grid">
          <div class="stat-card clickable" onclick="switchToTab('reservations', 'makeup')">
            <div class="stat-icon stat-makeup">ğŸ“</div>
            <div class="stat-label">ì˜¤ëŠ˜ ë³´ì¶©ìˆ˜ì—… ì˜ˆì•½</div>
            <div class="stat-value"><%= @makeup_todays_reservations || 0 %></div>
          </div>
          <div class="stat-card clickable" onclick="switchToTab('reservations', 'makeup')">
            <div class="stat-icon stat-makeup">âœï¸</div>
            <div class="stat-label">ì§„í–‰ì¤‘ì¸ ë³´ì¶©ìˆ˜ì—… ì˜ˆì•½</div>
            <div class="stat-value"><%= @makeup_active_reservations || 0 %></div>
          </div>
        </div>
      </div>

      <!-- ì „ì²´ í†µê³„ ìš”ì•½ -->
      <div class="summary-card">
        <div class="summary-grid">
          <div class="summary-item">
            <div class="summary-label">ì „ì²´ íšŒì›</div>
            <div class="summary-value"><%= User.count %>ëª…</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">ì „ì²´ ì˜ˆì•½</div>
            <div class="summary-value"><%= Reservation.count %>ê±´</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">í™œì„± ì˜ˆì•½</div>
            <div class="summary-value"><%= Reservation.where(status: 'active').count %>ê±´</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">í˜ë„í‹° ë¶€ê³¼</div>
            <div class="summary-value"><%= Penalty.where('no_show_count > 0 OR cancel_count > 0').count %>ëª…</div>
          </div>
        </div>
      </div>
    </div>

    <!-- íšŒì› ê´€ë¦¬ íƒ­ -->
    <div id="users-tab" class="tab-content hidden">
      <div class="users-header" style="background: #ffffff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0; padding: 25px; margin-bottom: 20px;">
        <h2 class="users-title" style="font-size: 1.5rem; font-weight: bold; color: #2d3748; margin-bottom: 20px;">ğŸ‘¥ íšŒì› ê´€ë¦¬</h2>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-nav" style="display: flex; gap: 5px; margin-bottom: 20px; background: #f7fafc; padding: 5px; border-radius: 10px;">
          <button onclick="changeTab('approved')" data-tab="approved" class="tab-btn active">
            ìŠ¹ì¸ëœ íšŒì›
          </button>
          <button onclick="changeTab('waiting')" data-tab="waiting" class="tab-btn">
            ìŠ¹ì¸ ëŒ€ê¸°
          </button>
          <button onclick="changeTab('hold')" data-tab="hold" class="tab-btn">
            ë³´ë¥˜
          </button>
          <button onclick="changeTab('penalty')" data-tab="penalty" class="tab-btn">
            í˜ë„í‹°
          </button>
        </div>
        
        <!-- ê²€ìƒ‰ ë° í•„í„° -->
        <div class="search-filters" style="display: flex; gap: 12px; flex-wrap: wrap;">
          <input type="text" 
                 id="user-search" 
                 placeholder="ì´ë¦„ì´ë‚˜ ì•„ì´ë””ë¡œ ê²€ìƒ‰..." 
                 class="search-input"
                 style="flex: 1; min-width: 250px; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem; transition: all 0.3s ease;"
                 onkeypress="if(event.key==='Enter') searchUsers()">
          <button onclick="searchUsers()" class="search-button" style="padding: 12px 20px; border: 1px solid #667eea; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; background: #667eea; color: white;">ê²€ìƒ‰</button>
          <button onclick="clearSearch()" class="clear-button" style="padding: 12px 20px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; background: #f7fafc; color: #4a5568;">ì „ì²´ë³´ê¸°</button>
        </div>
      </div>
      
      <div id="users-content-area">
        <div class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-500"></div>
          <p class="text-gray-500 mt-2">íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    </div>

    <!-- ì˜ˆì•½ ê´€ë¦¬ íƒ­ -->
    <div id="reservations-tab" class="tab-content hidden">
      <div id="reservations-content-area">
        <div class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-500"></div>
          <p class="text-gray-500 mt-2">ì˜ˆì•½ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    </div>

    <a href="/services" class="back-link">
      â† ì„œë¹„ìŠ¤ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
    </a>
  </div>
</div>

<!-- ì·¨ì†Œ ì‚¬ìœ  ëª¨ë‹¬ -->
<div id="cancellation-reason-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
      <h3>ì˜ˆì•½ ì·¨ì†Œ ì‚¬ìœ </h3>
      <button class="close-btn" onclick="window.closeCancellationModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-info">
        <div class="info-row">
          <strong>ì´ë¦„:</strong> <span id="cancel-modal-user-name"></span>
        </div>
        <div class="info-row">
          <strong>ë‚ ì§œ:</strong> <span id="cancel-modal-date"></span>
        </div>
        <div class="info-row">
          <strong>ì‹œê°„:</strong> <span id="cancel-modal-time"></span>
        </div>
        <div class="info-row">
          <strong>ì—°ìŠµì‹¤:</strong> <span id="cancel-modal-room"></span>
        </div>
      </div>
      <div class="modal-lesson-content">
        <strong>ì·¨ì†Œ ì‚¬ìœ :</strong>
        <div id="cancel-modal-reason" class="lesson-content-text"></div>
      </div>
    </div>
  </div>
</div>

<style>
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }

  .modal.show {
    display: block;
  }

  .modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 0;
    border: none;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid #e2e8f0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px 8px 0 0;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
  }

  .close-btn:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }

  .modal-body {
    padding: 24px;
  }

  .modal-info {
    margin-bottom: 20px;
  }

  .info-row {
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .info-row strong {
    color: #4a5568;
    font-weight: 600;
    min-width: 60px;
  }

  .modal-lesson-content {
    border-top: 1px solid #e2e8f0;
    padding-top: 20px;
  }

  .modal-lesson-content strong {
    color: #4a5568;
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
  }

  .lesson-content-text {
    background-color: #f7fafc;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    padding: 12px;
    min-height: 80px;
    line-height: 1.5;
    color: #2d3748;
    white-space: pre-wrap;
  }
</style>

<script>
  // ì „ì—­ í•¨ìˆ˜ë“¤ ì´ˆê¸°í™”
  if (typeof window.adminFunctionsInitialized === 'undefined') {
    window.adminFunctionsInitialized = true;
    
    // í•„í„° ìƒíƒœ ì €ì¥ ë° ë³µì› ê¸°ëŠ¥
    window.saveFilters = function(type) {
      if (type === 'users') {
        const searchInput = document.getElementById('user-search');
        if (searchInput) {
          sessionStorage.setItem('admin_users_search', searchInput.value);
          sessionStorage.setItem('admin_users_tab', window.currentUsersTab || 'approved');
        }
      } else if (type === 'reservations') {
        const searchInput = document.getElementById('reservation-search');
        const statusFilter = document.getElementById('reservation-status');
        const dateFilter = document.getElementById('reservation-date');
        
        if (searchInput) sessionStorage.setItem('admin_reservations_search', searchInput.value);
        if (statusFilter) sessionStorage.setItem('admin_reservations_status', statusFilter.value);
        if (dateFilter) sessionStorage.setItem('admin_reservations_date', dateFilter.value);
        sessionStorage.setItem('admin_reservations_service', window.currentReservationService || 'practice');
      }
    };
    
    window.restoreFilters = function(type) {
      if (type === 'users') {
        const savedSearch = sessionStorage.getItem('admin_users_search');
        const searchInput = document.getElementById('user-search');
        if (searchInput && savedSearch) {
          searchInput.value = savedSearch;
          window.searchUsers();
        }
      } else if (type === 'reservations') {
        const savedSearch = sessionStorage.getItem('admin_reservations_search');
        const savedStatus = sessionStorage.getItem('admin_reservations_status');
        const savedDate = sessionStorage.getItem('admin_reservations_date');
        
        const searchInput = document.getElementById('reservation-search');
        const statusFilter = document.getElementById('reservation-status');
        const dateFilter = document.getElementById('reservation-date');
        
        if (searchInput && savedSearch) searchInput.value = savedSearch;
        if (statusFilter && savedStatus) statusFilter.value = savedStatus;
        if (dateFilter && savedDate) dateFilter.value = savedDate;
        
        if (savedSearch || savedStatus || savedDate) {
          window.filterReservations();
        }
      }
    };
    
    // íƒ­ ì „í™˜ í•¨ìˆ˜
    window.switchToTab = function(tab, subtab) {
      // ë„¤ë¹„ê²Œì´ì…˜ íƒ­ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      
      // ì½˜í…ì¸  íƒ­ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
      document.getElementById(`${tab}-tab`).classList.remove('hidden');
      
      // í•´ë‹¹ íƒ­ì˜ ì½˜í…ì¸  ë¡œë“œ
      if (tab === 'users') {
        loadUsersTab(subtab || 'approved');
      } else if (tab === 'reservations') {
        loadReservationsTab(subtab || 'practice');
      }
    };
    
    // íšŒì› ê´€ë¦¬ íƒ­ ë¡œë“œ
    window.loadUsersTab = function(tab, page = 1) {
      if (!tab) tab = sessionStorage.getItem('admin_users_tab') || window.currentUsersTab || 'approved';
      const contentArea = document.getElementById('users-content-area');
      if (!contentArea) return;
      
      window.currentUsersTab = tab;
      
      // ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
      const searchInput = document.getElementById('user-search');
      const searchQuery = searchInput ? searchInput.value : '';
      
      // íƒ­ ë²„íŠ¼ ì—…ë°ì´íŠ¸ (users-tab ë‚´ë¶€ì˜ ë²„íŠ¼ë“¤)
      document.querySelectorAll('#users-tab .tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      const activeBtn = document.querySelector(`#users-tab .tab-btn[data-tab="${tab}"]`);
      if (activeBtn) {
        activeBtn.classList.add('active');
      }
      
      contentArea.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-500"></div><p class="text-gray-500 mt-2">íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>';
      
      fetch(`/admin/users/content?tab=${tab}&page=${page}&search=${encodeURIComponent(searchQuery)}`)
        .then(response => response.text())
        .then(html => {
          contentArea.innerHTML = html;
        })
        .catch(error => {
          console.error('Error loading users:', error);
          contentArea.innerHTML = '<div class="text-center py-8 text-red-600">íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
        });
    };
    
    
    // ì˜ˆì•½ ê´€ë¦¬ íƒ­ ë¡œë“œ
    window.loadReservationsTab = function(service) {
      if (!service) service = sessionStorage.getItem('admin_reservations_service') || window.currentReservationService || 'practice';
      const contentArea = document.getElementById('reservations-content-area');
      if (!contentArea) return;
      
      window.currentReservationService = service;
      
      contentArea.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-500"></div><p class="text-gray-500 mt-2">ì˜ˆì•½ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>';
      
      fetch(`/admin/reservations/content?service=${service}`)
        .then(response => response.text())
        .then(html => {
          contentArea.innerHTML = html;
          // í•„í„° ë³µì›
          setTimeout(() => window.restoreFilters('reservations'), 100);
          
          // ì˜ˆì•½ ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ì„ ì „ì—­ì— ë“±ë¡
          window.searchReservations = function() {
            const searchInput = document.getElementById('reservation-search');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.toLowerCase();
            const rows = document.querySelectorAll('.reservation-row');
            
            rows.forEach(row => {
              const name = (row.getAttribute('data-name') || '').toLowerCase();
              const username = (row.getAttribute('data-username') || '').toLowerCase();
              
              if (searchTerm === '' || name.includes(searchTerm) || username.includes(searchTerm)) {
                row.style.display = '';
              } else {
                row.style.display = 'none';
              }
            });
          };
        
          window.filterReservations = function() {
            const statusFilter = document.getElementById('reservation-status')?.value || '';
            const dateFilter = document.getElementById('reservation-date')?.value || '';
            const searchTerm = (document.getElementById('reservation-search')?.value || '').toLowerCase();
            const rows = document.querySelectorAll('.reservation-row');
            
            rows.forEach(row => {
              let visible = true;
              
              // ê²€ìƒ‰ì–´ í•„í„°
              if (searchTerm) {
                const name = (row.getAttribute('data-name') || '').toLowerCase();
                const username = (row.getAttribute('data-username') || '').toLowerCase();
                if (!name.includes(searchTerm) && !username.includes(searchTerm)) {
                  visible = false;
                }
              }
              
              // ìƒíƒœ í•„í„°
              if (statusFilter && visible) {
                const status = row.getAttribute('data-status');
                if (status !== statusFilter) {
                  visible = false;
                }
              }
              
              // ë‚ ì§œ í•„í„°
              if (dateFilter && visible) {
                const date = row.getAttribute('data-date');
                if (date !== dateFilter) {
                  visible = false;
                }
              }
              
              row.style.display = visible ? '' : 'none';
            });
          };
        
          window.resetReservationFilters = function() {
            const searchInput = document.getElementById('reservation-search');
            const statusSelect = document.getElementById('reservation-status');
            const dateInput = document.getElementById('reservation-date');
            
            if (searchInput) searchInput.value = '';
            if (statusSelect) statusSelect.value = '';
            if (dateInput) dateInput.value = '';
            
            const rows = document.querySelectorAll('.reservation-row');
            rows.forEach(row => {
              row.style.display = '';
            });
          };
        
          window.updateReservationStatus = function(reservationId, status, service) {
            fetch(`/admin/reservations/${reservationId}/update_status`, {
              method: 'PATCH',
              headers: {
                'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
                'Content-Type': 'application/json',
                'Accept': 'application/json'
              },
              body: JSON.stringify({ status: status, service: service })
            }).then(response => {
              if (response.ok) {
                window.loadReservationsTab(service);
              } else {
                alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
              }
            }).catch(error => {
              console.error('Error:', error);
              alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
          };
        
          window.deleteReservation = function(reservationId, service) {
            if (confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              fetch(`/admin/reservations/${reservationId}`, {
                method: 'DELETE',
                headers: {
                  'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
                  'Content-Type': 'application/json',
                  'Accept': 'application/json'
                },
                body: JSON.stringify({ service: service })
              }).then(response => {
                if (response.ok) {
                  window.loadReservationsTab(service);
                } else {
                  alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
              }).catch(error => {
                console.error('Error:', error);
                alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
              });
            }
          };
          
          console.log('ì˜ˆì•½ ê´€ë¦¬ í•¨ìˆ˜ë“¤ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        })
        .catch(error => {
          console.error('Error loading reservations:', error);
          contentArea.innerHTML = '<div class="text-center py-8 text-red-600">ì˜ˆì•½ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
        });
    };
    
    // ê¸°íƒ€ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    window.changeTab = function(tab) {
      loadUsersTab(tab);
    };
    
    window.getCurrentTab = function() {
      const activeTabBtn = document.querySelector('#users-tab .tab-btn.active');
      if (activeTabBtn) {
        return activeTabBtn.dataset.tab;
      }
      return window.currentUsersTab || 'approved';
    };
    
    // ê²€ìƒ‰ í•¨ìˆ˜
    window.searchUsers = function() {
      const currentTab = window.getCurrentTab();
      window.loadUsersTab(currentTab, 1); // ê²€ìƒ‰ ì‹œ í˜ì´ì§€ëŠ” 1ë¡œ ë¦¬ì…‹
    };
    
    window.clearSearch = function() {
      const searchInput = document.getElementById('user-search');
      if (searchInput) {
        searchInput.value = '';
      }
      const currentTab = window.getCurrentTab();
      window.loadUsersTab(currentTab, 1);
    };

    // ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤
    window.holdUser = function(userId, system) {
      if(confirm('ì´ ì‚¬ìš©ìë¥¼ ë³´ë¥˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        window.saveFilters('users'); // í•„í„° ìƒíƒœ ì €ì¥
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/hold` : `/admin/practice/users/${userId}/hold`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.loadUsersTab(); // íƒ­ ì¬ë¡œë“œ (í•„í„° ìë™ ë³µì›)
        });
      }
    };

    window.approveUser = function(userId, system) {
      if(confirm('ì´ ì‚¬ìš©ìë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        window.saveFilters('users');
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/approve` : `/admin/practice/users/${userId}/approve`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.loadUsersTab();
        });
      }
    };

    window.rejectUser = function(userId, system) {
      if(confirm('ì´ ì‚¬ìš©ìë¥¼ ê±°ë¶€/ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        window.saveFilters('users');
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reject` : `/admin/practice/users/${userId}/reject`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.loadUsersTab();
        });
      }
    };

    window.deleteUser = function(userId, system) {
      if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        window.saveFilters('users');
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reject` : `/admin/practice/users/${userId}/reject`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(() => {
          window.loadUsersTab();
        });
      }
    };

    window.updateTeacher = function(userId, teacher, system) {
      const url = system === 'makeup' ? `/admin/makeup/users/${userId}/update_teacher` : `/admin/practice/users/${userId}/update_teacher`;
      fetch(url, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ teacher: teacher })
      });
    };

    window.resetPassword = function(userId, username, system) {
      const newPassword = prompt(`${username}ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìµœì†Œ 6ì):`);
      if (newPassword && newPassword.length >= 6) {
        window.saveFilters('users');
        const url = system === 'makeup' ? `/admin/makeup/users/${userId}/reset_password` : `/admin/practice/users/${userId}/reset_password`;
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ password: newPassword })
        }).then(() => {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
          // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •ì€ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ì´ í•„ìš”ì—†ìŒ
        });
      } else if (newPassword) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
      }
    };

    window.resetPenalty = function(userId, system, event) {
      if(confirm('ì´ ì‚¬ìš©ìì˜ í˜ë„í‹°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        let url;
        if (system === 'pitch') {
          url = `/admin/pitch/penalties/${userId}/reset`;
        } else if (system === 'makeup') {
          url = `/admin/makeup/users/${userId}/reset_penalty`;
        } else {
          url = `/admin/practice/users/${userId}/reset_penalty`;
        }
        
        const button = event.currentTarget;
        button.disabled = true;
        button.textContent = 'ì²˜ë¦¬ì¤‘...';
        
        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json'
          }
        }).then(response => {
          if (response.ok) {
            const row = button.closest('tr');
            if (row) {
              button.textContent = 'ì´ˆê¸°í™”ë¨';
              button.className = 'text-green-600 font-medium cursor-default';
              row.style.transition = 'opacity 0.5s ease-out';
              row.style.opacity = '0.5';
              
              setTimeout(() => {
                row.remove();
                const tbody = document.querySelector('.user-table-body');
                if (tbody && tbody.children.length === 0) {
                  const emptyMessage = document.createElement('tr');
                  emptyMessage.innerHTML = '<td colspan="9" class="text-center py-4 text-gray-500">í˜ë„í‹°ê°€ ìˆëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
                  tbody.appendChild(emptyMessage);
                }
              }, 500);
            }
          } else {
            alert('í˜ë„í‹° ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            button.disabled = false;
            button.textContent = 'ì´ˆê¸°í™”';
          }
        });
      }
    };

    // ì˜ˆì•½ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    window.updateReservationStatus = function(reservationId, status, service) {
      window.saveFilters('reservations'); // í•„í„° ìƒíƒœ ì €ì¥
      fetch(`/admin/reservations/${reservationId}/update_status`, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ status: status, service: service })
      }).then(response => {
        if (response.ok) {
          window.loadReservationsTab(service); // í•„í„° ìë™ ë³µì›
        } else {
          alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }).catch(error => {
        console.error('Error:', error);
        alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      });
    };

    window.deleteReservation = function(reservationId, service) {
      if (confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        window.saveFilters('reservations');
        
        // ë¶€ë“œëŸ¬ìš´ ì‚­ì œë¥¼ ìœ„í•´ ìƒˆë¡œìš´ í•¨ìˆ˜ ì‚¬ìš©
        if (typeof window.deleteReservationSmooth === 'function') {
          window.deleteReservationSmooth(reservationId, service, { currentTarget: event.currentTarget });
          return;
        }
        
        fetch(`/admin/reservations/${reservationId}`, {
          method: 'DELETE',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ service: service })
        }).then(response => {
          if (response.ok) {
            window.loadReservationsTab(service);
          } else {
            alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        }).catch(error => {
          console.error('Error:', error);
          alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        });
      }
    };

    // ì „í™”ë²ˆí˜¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    window.updatePhone = function(userId, type, system) {
      console.log('ğŸ“ updatePhone í˜¸ì¶œ:', userId, type, system);
      
      const phoneInput = document.getElementById(`phone-${type}-${userId}`);
      if (!phoneInput) {
        console.log('ğŸš« phone inputì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', `phone-${type}-${userId}`);
        return;
      }
      
      const phone = phoneInput.value;
      console.log('ğŸ“ ì…ë ¥ëœ ì „í™”ë²ˆí˜¸:', phone);
      
      const endpoint = system === 'makeup' ? 
        `/admin/makeup/users/${userId}/update_info` : 
        `/admin/practice/users/${userId}/update_info`;
      
      fetch(endpoint, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ phone: phone })
      }).then(response => {
        console.log('ğŸ“ ì„œë²„ ì‘ë‹µ:', response.status);
        if(response.ok) {
          alert('ì „í™”ë²ˆí˜¸ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
          alert('ì „í™”ë²ˆí˜¸ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }).catch(error => {
        console.error('ğŸš« ì˜¤ë¥˜:', error);
        alert('ì „í™”ë²ˆí˜¸ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      });
    };

    // ë¶€ë“œëŸ¬ìš´ ìŠ¹ì¸/ê±°ì ˆ ë²„íŠ¼ í•¨ìˆ˜
    window.approveReservationSmooth = function(reservationId, service, event) {
      const button = event ? event.currentTarget : null;
      const row = button ? button.closest('tr') : null;
      const selectElement = row ? row.querySelector('select') : null;

      if (button) {
        button.disabled = true;
        button.textContent = 'ì²˜ë¦¬ì¤‘...';
        button.style.opacity = '0.6';
      }

      // ìŒì •ìˆ˜ì—…ì€ 'approved', ë³´ì¶©ìˆ˜ì—…ì€ 'active'
      const targetStatus = service === 'pitch' ? 'approved' : 'active';
      window.updateReservationStatusSmooth(reservationId, targetStatus, service, selectElement);
    };
    
    window.rejectReservationSmooth = function(reservationId, service, event) {
      const button = event ? event.currentTarget : null;
      const row = button ? button.closest('tr') : null;
      const selectElement = row ? row.querySelector('select') : null;
      
      if (button) {
        button.disabled = true;
        button.textContent = 'ì²˜ë¦¬ì¤‘...';
        button.style.opacity = '0.6';
      }
      
      window.updateReservationStatusSmooth(reservationId, 'rejected', service, selectElement);
    };

    // ë¶€ë“œëŸ¬ìš´ ì‚­ì œ í•¨ìˆ˜ ì •ì˜
    window.deleteReservationSmooth = function(reservationId, service, event) {
      console.log('ğŸ”¥ deleteReservationSmooth ì‹¤í–‰:', reservationId, service);
      
      if (confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const button = event ? event.currentTarget : null;
        const row = button ? button.closest('tr') : document.querySelector(`tr[data-reservation-id="${reservationId}"]`);
        
        if (button) {
          button.disabled = true;
          button.textContent = 'ì²˜ë¦¬ì¤‘...';
          button.style.background = '#9ca3af';
          button.style.cursor = 'not-allowed';
        }
        
        fetch(`/admin/reservations/${reservationId}`, {
          method: 'DELETE',
          headers: {
            'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ service: service })
        }).then(response => {
          if (response.ok) {
            if (row) {
              console.log('âœ¨ í–‰ ì‚­ì œ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘...');
              // ë¶€ë“œëŸ¬ìš´ í˜ì´ë“œ ì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜
              row.style.transition = 'all 0.5s ease-out';
              row.style.opacity = '0';
              row.style.transform = 'translateX(-20px)';
              row.style.backgroundColor = '#fee2e2';
              
              // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ í–‰ ì œê±°
              setTimeout(() => {
                row.remove();
                console.log('ğŸ‰ í–‰ì´ ì„±ê³µì ìœ¼ë¡œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // í…Œì´ë¸”ì´ ë¹„ì–´ìˆìœ¼ë©´ empty state í‘œì‹œ
                const tbody = document.querySelector('.reservations-table tbody');
                if (tbody && tbody.children.length === 0) {
                  const tableContainer = document.querySelector('.reservations-content');
                  if (tableContainer) {
                    tableContainer.innerHTML = `
                      <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“…</div>
                        <div class="empty-state-text">ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</div>
                      </div>
                    `;
                  }
                }
              }, 500);
            } else {
              // fallback: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
              if (typeof window.loadReservationsTab === 'function') {
                window.loadReservationsTab(service);
              }
            }
          } else {
            alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            if (button) {
              button.disabled = false;
              button.textContent = 'ì‚­ì œ';
              button.style.background = '';
              button.style.cursor = 'pointer';
            }
          }
        }).catch(error => {
          console.error('Error:', error);
          alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          if (button) {
            button.disabled = false;
            button.textContent = 'ì‚­ì œ';
            button.style.background = '';
            button.style.cursor = 'pointer';
          }
        });
      }
    };

    // ë¶€ë“œëŸ¬ìš´ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì •ì˜
    window.updateReservationStatusSmooth = function(reservationId, status, service, selectElement) {
      console.log('ğŸ”„ ìƒíƒœ ì—…ë°ì´íŠ¸:', reservationId, status, service);
      
      const originalValue = selectElement.value;
      const row = selectElement.closest('tr');
      
      // ë¡œë”© ìƒíƒœ í‘œì‹œ
      selectElement.disabled = true;
      selectElement.style.opacity = '0.6';
      
      fetch(`/admin/reservations/${reservationId}/update_status`, {
        method: 'PATCH',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ status: status, service: service })
      }).then(response => {
        if (response.ok) {
          // ìƒíƒœ ë°°ì§€ ì—…ë°ì´íŠ¸
          const statusBadge = row.querySelector('.status-badge');
          if (statusBadge) {
            const statusTexts = {
              'pending': service === 'makeup' || service === 'pitch' ? 'ìŠ¹ì¸ ëŒ€ê¸°' : 'ëŒ€ê¸°',
              'active': service === 'makeup' ? 'ìˆ˜ì—… ëŒ€ê¸°' : 'ì´ìš© ì „',
              'approved': service === 'pitch' ? 'ìˆ˜ì—… ëŒ€ê¸°' : 'ìŠ¹ì¸',
              'completed': 'ì™„ë£Œ',
              'cancelled': 'ì·¨ì†Œ',
              'rejected': 'ê±°ì ˆë¨',
              'no_show': 'ë…¸ì‡¼'
            };
            
            console.log('âœ¨ ìƒíƒœ ë°°ì§€ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘...');
            // ë¶€ë“œëŸ¬ìš´ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜
            statusBadge.style.transition = 'all 0.3s ease';
            statusBadge.style.transform = 'scale(1.1)';
            
            setTimeout(() => {
              // CSS í´ë˜ìŠ¤ ë§¤í•‘ (ìŒì •ìˆ˜ì—…ì˜ approvedëŠ” active ìŠ¤íƒ€ì¼ ì‚¬ìš©)
              let cssClass = status.replace('_', '-');
              if (service === 'pitch' && status === 'approved') {
                cssClass = 'active';  // ìŒì •ìˆ˜ì—…ì˜ ìŠ¹ì¸ ì™„ë£ŒëŠ” active ìŠ¤íƒ€ì¼ ì‚¬ìš©
              }
              statusBadge.className = 'status-badge status-' + cssClass;
              statusBadge.textContent = statusTexts[status] || status;
              statusBadge.style.transform = 'scale(1)';
              console.log('ğŸ¯ ìƒíƒœ ë³€ê²½ ì™„ë£Œ:', statusTexts[status]);
            }, 150);
          }
          
          // data-status ì—…ë°ì´íŠ¸
          row.setAttribute('data-status', status);

          // select ë°•ìŠ¤ ê°’ë„ ì—…ë°ì´íŠ¸
          selectElement.value = status;

          // ìŠ¹ì¸/ê±°ì ˆ ë²„íŠ¼ ìˆ¨ê¸°ê¸° (pendingì—ì„œ ë³€ê²½ëœ ê²½ìš°)
          if ((service === 'makeup' || service === 'pitch') && status !== 'pending') {
            const approveBtn = row.querySelector('.btn-approve');
            const rejectBtn = row.querySelector('.btn-reject');
            if (approveBtn || rejectBtn) {
              // ë¶€ë“œëŸ¬ìš´ í˜ì´ë“œ ì•„ì›ƒ
              [approveBtn, rejectBtn].forEach(btn => {
                if (btn) {
                  btn.style.transition = 'all 0.3s ease';
                  btn.style.opacity = '0';
                  btn.style.transform = 'scale(0.8)';
                  setTimeout(() => btn.style.display = 'none', 300);
                }
              });
            }
          }
          
        } else {
          alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          selectElement.value = originalValue;
        }
      }).catch(error => {
        console.error('Error:', error);
        alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        selectElement.value = originalValue;
      }).finally(() => {
        selectElement.disabled = false;
        selectElement.style.opacity = '1';
      });
    };

    // í˜ì´ì§€ ë³€ê²½ í•¨ìˆ˜
    window.changePage = function(page) {
      const currentTab = window.getCurrentTab();
      window.loadUsersTab(currentTab, page);
    };
  }
  
  // íƒ­ ì „í™˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  document.addEventListener('click', function(e) {
    const tabLink = e.target.closest('.nav-tab');
    if (!tabLink) return;
    
    e.preventDefault();
    
    const tabName = tabLink.getAttribute('data-tab');
    
    // ë„¤ë¹„ê²Œì´ì…˜ íƒ­ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    tabLink.classList.add('active');
    
    // ì½˜í…ì¸  íƒ­ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
    document.getElementById(`${tabName}-tab`).classList.remove('hidden');
    
    // í•´ë‹¹ íƒ­ì˜ ì½˜í…ì¸  ë¡œë“œ
    if (tabName === 'users') {
      loadUsersTab();
    } else if (tabName === 'reservations') {
      loadReservationsTab();
    }
  });
  
  // ë³´ì¶©ìˆ˜ì—… ë‚´ìš© ëª¨ë‹¬ í•¨ìˆ˜ë“¤ì„ ì „ì—­ìœ¼ë¡œ ì •ì˜ (AJAX ë¡œë“œ ì „ì—ë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡)
  window.showLessonContent = function(reservationId) {
    fetch('/admin/reservations/' + reservationId + '/lesson_content')
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('modal-user-name').textContent = data.user_name;
          document.getElementById('modal-date').textContent = data.date;
          document.getElementById('modal-time').textContent = data.time;
          document.getElementById('modal-week-number').textContent = data.week_number ? data.week_number + 'ì£¼ì°¨' : 'ì£¼ì°¨ ì •ë³´ ì—†ìŒ';
          document.getElementById('modal-lesson-content').textContent = data.lesson_content || 'ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';
          document.getElementById('lesson-content-modal').classList.add('show');
        } else {
          alert('ì˜ˆì•½ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
  }

  // ìŒì •ìˆ˜ì—… ë©”ëª¨ ë³´ê¸°
  window.showPitchNotes = function(reservationId) {
    fetch('/admin/reservations/' + reservationId + '/lesson_content?service=pitch')
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // ìŒì •ìˆ˜ì—…ìš© ëª¨ë‹¬ì´ ì—†ìœ¼ë©´ ë³´ì¶©ìˆ˜ì—… ëª¨ë‹¬ ì¬ì‚¬ìš©
          var modal = document.getElementById('pitch-notes-modal');
          if (!modal) {
            // ê¸°ì¡´ lesson-content-modal ì‚¬ìš©
            document.getElementById('modal-user-name').textContent = data.user_name;
            document.getElementById('modal-date').textContent = data.date;
            document.getElementById('modal-time').textContent = data.time;
            document.getElementById('modal-week-number').textContent = data.week_number ? data.week_number + 'ì£¼ì°¨' : 'ì£¼ì°¨ ì •ë³´ ì—†ìŒ';
            document.getElementById('modal-lesson-content').textContent = data.notes || 'ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.';
            document.getElementById('lesson-content-modal').classList.add('show');
          }
        } else {
          alert('ì˜ˆì•½ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
  }

  window.closeLessonModal = function() {
    var modal = document.getElementById('lesson-content-modal');
    if (modal) {
      modal.classList.remove('show');
    }
  }

  // ë³´ì¶©ìˆ˜ì—… ì·¨ì†Œ ì‚¬ìœ  ëª¨ë‹¬ í•¨ìˆ˜ë“¤ì„ ì „ì—­ìœ¼ë¡œ ì •ì˜
  window.showMakeupCancellationReason = function(reservationId) {
    fetch('/admin/reservations/' + reservationId + '/makeup_cancellation_reason')
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('cancel-modal-user-name').textContent = data.user_name;
          document.getElementById('cancel-modal-date').textContent = data.date;
          document.getElementById('cancel-modal-time').textContent = data.time;
          document.getElementById('cancel-modal-room').textContent = data.room;
          document.getElementById('cancel-modal-reason').textContent = data.cancellation_reason || 'ì‚¬ìœ ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
          document.getElementById('cancellation-reason-modal').classList.add('show');
        } else {
          alert('ì˜ˆì•½ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
  }

  window.closeCancellationModal = function() {
    var modal = document.getElementById('cancellation-reason-modal');
    if (modal) {
      modal.classList.remove('show');
    }
  }
</script>