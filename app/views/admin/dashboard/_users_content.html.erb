<style>
  .users-container {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    overflow: hidden;
  }
  
  .users-header {
    padding: 25px;
    border-bottom: 1px solid #e2e8f0;
  }
  
  .users-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2d3748;
    margin-bottom: 20px;
  }
  
  .tab-nav {
    display: flex;
    gap: 5px;
    margin-bottom: 20px;
    background: #f7fafc;
    padding: 5px;
    border-radius: 10px;
  }
  
  .tab-btn {
    padding: 10px 16px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    background: transparent;
    color: #4a5568;
  }
  
  .tab-btn:hover {
    background: #edf2f7;
    color: #2d3748;
  }
  
  .tab-btn.active {
    background: #ffffff;
    color: #667eea;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  .search-filters {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  
  .search-input {
    flex: 1;
    min-width: 250px;
    padding: 12px 16px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }
  
  .search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .filter-select {
    padding: 12px 16px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.9rem;
    background: white;
    color: #4a5568;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .filter-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .users-content {
    padding: 25px;
  }
  
  .users-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }
  
  .table-header {
    background: #f8fafc;
  }
  
  .table-header th {
    padding: 15px 12px;
    text-align: left;
    font-weight: 600;
    font-size: 0.8rem;
    color: #4a5568;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 1px solid #e2e8f0;
  }
  
  .table-header th:first-child {
    border-radius: 8px 0 0 0;
  }
  
  .table-header th:last-child {
    border-radius: 0 8px 0 0;
  }
  
  .user-row {
    transition: background-color 0.2s ease;
  }
  
  .user-row:hover {
    background: #f8fafc;
  }
  
  .user-row td {
    padding: 15px 12px;
    border-bottom: 1px solid #f1f5f9;
    font-size: 0.9rem;
  }
  
  .user-row.waiting-row {
    background: #fffbeb;
  }
  
  .user-row.hold-row {
    background: #fef3f2;
  }
  
  .user-row.penalty-row {
    background: #fef2f2;
  }
  
  .user-name {
    font-weight: 600;
    color: #2d3748;
  }
  
  .admin-badge {
    display: inline-flex;
    align-items: center;
    background: linear-gradient(135deg, #fa709a, #fee140);
    color: white;
    font-size: 0.7rem;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 12px;
    margin-left: 8px;
  }
  
  .admin-badge::after {
    content: 'ğŸ‘‘';
    margin-left: 4px;
  }
  
  .phone-input {
    padding: 6px 10px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    font-size: 0.85rem;
    width: 120px;
    margin-right: 8px;
    transition: all 0.3s ease;
  }
  
  .phone-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
  }
  
  .phone-update-btn {
    background: #667eea;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .phone-update-btn:hover {
    background: #5a67d8;
    transform: translateY(-1px);
  }
  
  .teacher-select {
    padding: 6px 10px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    font-size: 0.85rem;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .teacher-select:focus {
    outline: none;
    border-color: #667eea;
  }
  
  .status-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  
  .status-waiting {
    background: #fef3c7;
    color: #92400e;
  }
  
  .status-hold {
    background: #fed7aa;
    color: #c2410c;
  }
  
  .status-blocked {
    background: #fecaca;
    color: #991b1b;
  }
  
  .status-warning {
    background: #fed7aa;
    color: #c2410c;
  }
  
  .status-normal {
    background: #dcfce7;
    color: #166534;
  }
  
  .system-badge {
    padding: 3px 8px;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  
  .system-practice {
    background: #e0e7ff;
    color: #3730a3;
  }
  
  .system-makeup {
    background: #fce7f3;
    color: #be185d;
  }
  
  .action-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-right: 6px;
  }
  
  .action-btn:hover {
    transform: translateY(-1px);
  }
  
  .btn-approve {
    background: #10b981;
    color: white;
  }
  
  .btn-approve:hover {
    background: #059669;
  }
  
  .btn-hold {
    background: #f59e0b;
    color: white;
  }
  
  .btn-hold:hover {
    background: #d97706;
  }
  
  .btn-reject {
    background: #ef4444;
    color: white;
  }
  
  .btn-reject:hover {
    background: #dc2626;
  }
  
  .btn-reset {
    background: #8b5cf6;
    color: white;
  }
  
  .btn-reset:hover {
    background: #7c3aed;
  }
  
  .btn-text {
    background: none;
    color: #667eea;
    border: none;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.3s ease;
  }
  
  .btn-text:hover {
    background: #eef2ff;
    color: #5a67d8;
  }
  
  .penalty-count {
    font-size: 1.2rem;
    font-weight: bold;
  }
  
  .penalty-high {
    color: #dc2626;
  }
  
  .penalty-medium {
    color: #f59e0b;
  }
  
  .penalty-low {
    color: #6b7280;
  }
  
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #9ca3af;
  }
  
  .empty-state-icon {
    font-size: 3rem;
    margin-bottom: 16px;
  }
  
  .empty-state-text {
    font-size: 1.1rem;
    font-weight: 500;
  }
</style>

<div class="users-container">
  <div class="users-header">
    <h2 class="users-title">ğŸ‘¥ íšŒì› ê´€ë¦¬</h2>
    
    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="tab-nav">
      <button onclick="changeTab('approved')" class="tab-btn <%= 'active' if @tab == 'approved' %>">
        ìŠ¹ì¸ëœ íšŒì›
      </button>
      <button onclick="changeTab('waiting')" class="tab-btn <%= 'active' if @tab == 'waiting' %>">
        ìŠ¹ì¸ ëŒ€ê¸°
      </button>
      <button onclick="changeTab('hold')" class="tab-btn <%= 'active' if @tab == 'hold' %>">
        ë³´ë¥˜
      </button>
      <button onclick="changeTab('penalty')" class="tab-btn <%= 'active' if @tab == 'penalty' %>">
        í˜ë„í‹°
      </button>
    </div>
    
    <!-- ê²€ìƒ‰ ë° í•„í„° -->
    <div class="search-filters">
      <input type="text" 
             id="user-search" 
             placeholder="ì´ë¦„ì´ë‚˜ ì•„ì´ë””ë¡œ ê²€ìƒ‰..." 
             class="search-input"
             onkeyup="searchUsers()">
      
      <select id="system-filter" class="filter-select" onchange="filterBySystem()">
        <option value="">ì „ì²´ ì‹œìŠ¤í…œ</option>
        <option value="practice">ì—°ìŠµì‹¤</option>
        <option value="makeup">ë³´ì¶©ìˆ˜ì—…</option>
      </select>
    </div>
  </div>

  <div class="users-content">
    <!-- ìŠ¹ì¸ ëŒ€ê¸° íƒ­ -->
    <% if @tab == 'waiting' %>
      <% if @pending_users&.any? %>
        <table class="users-table">
          <thead class="table-header">
            <tr>
              <th>ì´ë¦„</th>
              <th>ì•„ì´ë””</th>
              <th>ì „í™”ë²ˆí˜¸</th>
              <th>ë‹´ë‹¹</th>
              <th>ê°€ì…ì¼</th>
              <th>ìƒíƒœ</th>
              <th>ì‘ì—…</th>
            </tr>
          </thead>
          <tbody class="user-table-body">
            <% @pending_users.each do |user| %>
              <tr class="user-row waiting-row" data-name="<%= user['name'] %>" data-username="<%= user['username'] %>" data-system="<%= user['system'] || 'practice' %>">
                <td><span class="user-name"><%= user['name'] %></span></td>
                <td><%= user['username'] %></td>
                <td>
                  <input type="tel" 
                         id="phone-pending-<%= user['id'] %>"
                         value="<%= user['phone'] || '' %>" 
                         placeholder="ë¯¸ë“±ë¡"
                         class="phone-input">
                  <button onclick="updatePhone(<%= user['id'] %>, 'pending', '<%= user['system'] %>')" 
                          class="phone-update-btn">í™•ì¸</button>
                </td>
                <td>
                  <select onchange="updateTeacher(<%= user['id'] %>, this.value, '<%= user['system'] %>')" 
                          class="teacher-select">
                    <% ['ë¬´ì„±', 'ì„±ê· ', 'ë…¸ë„¤ì„', 'ë¡œí•œ', 'ë²”ì„', 'ë‘ë°•', 'ì˜¤ë˜', 'ì§€ëª…', 'ë„í˜„'].each do |teacher| %>
                      <option value="<%= teacher %>" <%= 'selected' if user['teacher'] == teacher %>><%= teacher %></option>
                    <% end %>
                  </select>
                </td>
                <td style="font-size: 0.8rem; color: #6b7280;"><%= DateTime.parse(user['created_at']).strftime('%Y-%m-%d') %></td>
                <td>
                  <span class="status-badge status-waiting">ëŒ€ê¸°ì¤‘</span>
                </td>
                <td>
                  <button onclick="approveUser(<%= user['id'] %>, '<%= user['system'] %>')" 
                          class="action-btn btn-approve">ìŠ¹ì¸</button>
                  <button onclick="holdUser(<%= user['id'] %>, '<%= user['system'] %>')"
                          class="action-btn btn-hold">ë³´ë¥˜</button>
                  <button onclick="rejectUser(<%= user['id'] %>, '<%= user['system'] %>')"
                          class="action-btn btn-reject">ê±°ë¶€</button>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">â³</div>
          <div class="empty-state-text">ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      <% end %>
    <% end %>

    <!-- ë³´ë¥˜ íƒ­ -->
    <% if @tab == 'hold' %>
      <% if @on_hold_users&.any? %>
        <table class="users-table">
          <thead class="table-header">
            <tr>
              <th>ì´ë¦„</th>
              <th>ì•„ì´ë””</th>
              <th>ì „í™”ë²ˆí˜¸</th>
              <th>ë‹´ë‹¹</th>
              <th>ê°€ì…ì¼</th>
              <th>ìƒíƒœ</th>
              <th>ì‘ì—…</th>
            </tr>
          </thead>
          <tbody class="user-table-body">
            <% @on_hold_users.each do |user| %>
              <tr class="user-row hold-row" data-name="<%= user['name'] %>" data-username="<%= user['username'] %>" data-system="<%= user['system'] || 'practice' %>">
                <td><span class="user-name"><%= user['name'] %></span></td>
                <td><%= user['username'] %></td>
                <td>
                  <input type="tel" 
                         id="phone-hold-<%= user['id'] %>"
                         value="<%= user['phone'] || '' %>" 
                         placeholder="ë¯¸ë“±ë¡"
                         class="phone-input">
                  <button onclick="updatePhone(<%= user['id'] %>, 'hold', '<%= user['system'] %>')" 
                          class="phone-update-btn">í™•ì¸</button>
                </td>
                <td>
                  <select onchange="updateTeacher(<%= user['id'] %>, this.value, '<%= user['system'] %>')" 
                          class="teacher-select">
                    <% ['ë¬´ì„±', 'ì„±ê· ', 'ë…¸ë„¤ì„', 'ë¡œí•œ', 'ë²”ì„', 'ë‘ë°•', 'ì˜¤ë˜', 'ì§€ëª…', 'ë„í˜„'].each do |teacher| %>
                      <option value="<%= teacher %>" <%= 'selected' if user['teacher'] == teacher %>><%= teacher %></option>
                    <% end %>
                  </select>
                </td>
                <td style="font-size: 0.8rem; color: #6b7280;"><%= DateTime.parse(user['created_at']).strftime('%Y-%m-%d') %></td>
                <td>
                  <span class="status-badge status-hold">ë³´ë¥˜ì¤‘</span>
                </td>
                <td>
                  <button onclick="approveUser(<%= user['id'] %>, '<%= user['system'] %>')" 
                          class="action-btn btn-approve">ìŠ¹ì¸</button>
                  <button onclick="rejectUser(<%= user['id'] %>, '<%= user['system'] %>')" 
                          class="action-btn btn-reject">ì‚­ì œ</button>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ”„</div>
          <div class="empty-state-text">ë³´ë¥˜ ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      <% end %>
    <% end %>

    <!-- ìŠ¹ì¸ëœ íšŒì› íƒ­ -->
    <% if @tab == 'approved' %>
      <% if @approved_users&.any? %>
        <table class="users-table">
          <thead class="table-header">
            <tr>
              <th>ì´ë¦„</th>
              <th>ì•„ì´ë””</th>
              <th>ì „í™”ë²ˆí˜¸</th>
              <th>ë‹´ë‹¹</th>
              <th>ë¹„ë°€ë²ˆí˜¸</th>
              <th>ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody class="user-table-body">
            <% @approved_users.each do |user| %>
              <tr class="user-row" data-name="<%= user['name'] %>" data-username="<%= user['username'] %>" data-system="<%= user['system'] || 'practice' %>">
                <td>
                  <span class="user-name"><%= user['name'] %></span>
                  <% if user['is_admin'] %>
                    <span class="admin-badge">ê´€ë¦¬ì</span>
                  <% end %>
                </td>
                <td><%= user['username'] %></td>
                <td>
                  <input type="tel" 
                         id="phone-approved-<%= user['id'] %>"
                         value="<%= user['phone'] || '' %>" 
                         placeholder="ë¯¸ë“±ë¡"
                         class="phone-input">
                  <button onclick="updatePhone(<%= user['id'] %>, 'approved', '<%= user['system'] %>')" 
                          class="phone-update-btn">í™•ì¸</button>
                </td>
                <td>
                  <select onchange="updateTeacher(<%= user['id'] %>, this.value, '<%= user['system'] %>')" 
                          class="teacher-select">
                    <% ['ë¬´ì„±', 'ì„±ê· ', 'ë…¸ë„¤ì„', 'ë¡œí•œ', 'ë²”ì„', 'ë‘ë°•', 'ì˜¤ë˜', 'ì§€ëª…', 'ë„í˜„'].each do |teacher| %>
                      <option value="<%= teacher %>" <%= 'selected' if user['teacher'] == teacher %>><%= teacher %></option>
                    <% end %>
                  </select>
                </td>
                <td>
                  <button onclick="resetPassword('<%= user['id'] %>', '<%= user['username'] %>', '<%= user['system'] %>')" 
                          class="btn-text">ì¬ì„¤ì •</button>
                </td>
                <td>
                  <% unless user['is_admin'] %>
                    <button onclick="holdUser(<%= user['id'] %>, '<%= user['system'] %>')" 
                            class="action-btn btn-hold">ë³´ë¥˜</button>
                    <button onclick="deleteUser(<%= user['id'] %>, '<%= user['system'] %>')" 
                            class="action-btn btn-reject">ì‚­ì œ</button>
                  <% else %>
                    <span style="color: #9ca3af;">-</span>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ‘¥</div>
          <div class="empty-state-text">ìŠ¹ì¸ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      <% end %>
    <% end %>

    <!-- í˜ë„í‹° íƒ­ -->
    <% if @tab == 'penalty' %>
      <% if @users_with_penalties&.any? %>
        <table class="users-table">
          <thead class="table-header">
            <tr>
              <th>ì´ë¦„</th>
              <th>ì•„ì´ë””</th>
              <th>ì‹œìŠ¤í…œ</th>
              <th>ë‹´ë‹¹</th>
              <th style="text-align: center;">ë…¸ì‡¼</th>
              <th style="text-align: center;">ì·¨ì†Œ</th>
              <th style="text-align: center;">ì´íšŸìˆ˜</th>
              <th>ìƒíƒœ</th>
              <th>ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody class="user-table-body">
            <% @users_with_penalties.each do |user| %>
              <% total_count = user['no_show_count'] + user['cancel_count'] %>
              <% is_blocked = user['is_blocked'] || (user['no_show_count'] >= 3) %>
              <tr class="user-row penalty-row" data-name="<%= user['name'] %>" data-username="<%= user['username'] %>" data-system="<%= user['system'] || 'practice' %>">
                <td><span class="user-name"><%= user['name'] %></span></td>
                <td><%= user['username'] %></td>
                <td>
                  <% if user['system'] == 'makeup' %>
                    <span class="system-badge system-makeup">ë³´ì¶©ìˆ˜ì—…</span>
                  <% else %>
                    <span class="system-badge system-practice">ì—°ìŠµì‹¤</span>
                  <% end %>
                </td>
                <td><%= user['teacher'] %></td>
                <td style="text-align: center;">
                  <span class="penalty-count <%= user['no_show_count'] > 0 ? 'penalty-high' : 'penalty-low' %>">
                    <%= user['no_show_count'] %>
                  </span>
                </td>
                <td style="text-align: center;">
                  <span class="penalty-count <%= user['cancel_count'] > 0 ? 'penalty-medium' : 'penalty-low' %>">
                    <%= user['cancel_count'] %>
                  </span>
                </td>
                <td style="text-align: center;">
                  <span class="penalty-count <%= total_count >= 5 ? 'penalty-high' : (total_count >= 3 ? 'penalty-medium' : 'penalty-low') %>">
                    <%= total_count %>
                  </span>
                </td>
                <td>
                  <% if is_blocked %>
                    <span class="status-badge status-blocked">ì°¨ë‹¨ë¨</span>
                  <% elsif total_count >= 3 %>
                    <span class="status-badge status-warning">ì£¼ì˜</span>
                  <% else %>
                    <span class="status-badge status-normal">ì •ìƒ</span>
                  <% end %>
                </td>
                <td>
                  <button onclick="resetPenalty(<%= user['id'] %>, '<%= user['system'] %>', event)" 
                          class="action-btn btn-reset">ì´ˆê¸°í™”</button>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">âœ…</div>
          <div class="empty-state-text">í˜ë„í‹°ê°€ ìˆëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>